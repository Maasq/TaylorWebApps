<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="author" content="S Taylor" />
        <meta name="description" content="A revision aid - SQA multiple choice questions." />
        <meta name="version" content="1.18.11" /> <meta name="date" content="2026-01-13" /> 

        <title>Higher Physics Revision</title>
        <link rel="icon" type="image/webp" href="mc icon.webp">

        <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

        <link rel="stylesheet" href="style.css">
        <script src="config.js"></script>
    </head>
    
    <body>
        <div id="splash-overlay">
            <img src="mc icon.webp" alt="Loading..." class="splash-icon">
        </div>
        
        <div id="toast-container"></div>

        <header class="header-container">
            <h1 class="header-title">Higher Physics Revision</h1>
            <h2 class="header-subtitle">Multiple Choice Practice</h2>
        </header>

        <div id="view-dashboard" class="view-section active-view">
            <div class="card">
                <h3>Select Practice Area</h3>

                <div id="manual-loader">
                    <strong>Local Mode / Load Failed</strong><br>
                    Please load <code>questions.csv</code> manually.<br>
                    <input type="file" id="csv-uploader" accept=".csv" style="margin-top:10px;">
                </div>

                <div class="filter-group">
                    <label>Unit</label>
                    <button class="ms-button" id="btn-unit">All Units</button>
                    <div class="ms-content" id="list-unit"></div>
                </div>

                <div class="filter-group">
                    <label>Topic</label>
                    <button class="ms-button" id="btn-topic">All Topics</button>
                    <div class="ms-content" id="list-topic"></div>
                </div>

                <div class="filter-group">
                    <label>Paper Year</label>
                    <button class="ms-button" id="btn-year">All Years</button>
                    <div class="ms-content" id="list-year"></div>
                </div>

                <label class="checkbox-wrapper" style="margin-bottom: 6px; margin-top: 20px;">
                    <input type="checkbox" id="chk-shuffle" checked>
                    <span>Shuffle Questions</span>
                </label>

                <div style="display: flex; align-items: flex-start; gap: 20px; margin-bottom: 6px;">
                    <label class="checkbox-wrapper" style="margin: 0;">
                        <input type="checkbox" id="chk-limit" onchange="toggleLimitOptions()">
                        <span>Limit Quiz Size</span>
                    </label>

                    <div id="limit-options" style="display:none; margin-top: -2px;">
                        <select id="sel-limit-count" style="padding: 5px; border: 2px solid var(--black); border-radius: 5px; font-weight: bold; cursor:pointer;" onchange="updateCountPreview()">
                            <option value="10">10 Questions</option>
                            <option value="20">20 Questions</option>
                            <option value="25" selected>25 Questions</option>
                            <option value="30">30 Questions</option>
                            <option value="50">50 Questions</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; align-items: flex-start; gap: 20px; margin-bottom: 25px;">
                    <label class="checkbox-wrapper" style="margin: 0;">
                        <input type="checkbox" id="chk-exam-mode" onchange="toggleExamOptions()">
                        <span>Exam Mode (timed)</span>
                    </label>

                    <div id="exam-options" style="display:none; flex-direction: column; gap: 8px; margin-top:2px;">
                        <label style="cursor: pointer; font-size: 0.9rem; font-weight:bold; display:flex; align-items:center;">
                            <input type="radio" name="exam-time" value="1.8" onchange="saveExamPref()" style="accent-color:var(--brand-primary); margin-right:6px;"> 
                            SQA timing (1.8 minutes per question)
                        </label>
                        <label style="cursor: pointer; font-size: 0.9rem; font-weight:bold; display:flex; align-items:center;">
                            <input type="radio" name="exam-time" value="2.3" onchange="saveExamPref()" style="accent-color:var(--brand-primary); margin-right:6px;"> 
                            Relaxed (2.3  minutes per question)
                        </label>
                    </div>
                </div>
                
                <div class="split-btn-container" id="start-btn-wrapper">
                    <button class="nav-btn split-main" id="btn-split-main" onclick="handleMainClick()">
                        Start Practice
                    </button>
                    <button class="nav-btn split-trigger" id="btn-split-trigger" onclick="toggleModeDropdown(event)">
                        ▼
                    </button>
                    <div id="mode-dropdown" class="mode-dropdown">
                        <div class="mode-option selected" onclick="selectMode('practice')">
                            <span class="mode-title">Practice</span>
                            <span class="mode-desc">Test your knowledge on your chosen topics.</span>
                        </div>
                        <div class="mode-option" id="opt-review" onclick="selectMode('review')">
                            <span class="mode-title">Review</span>
                            <span class="mode-desc" id="desc-review">Retake questions you have answered incorrectly.</span>
                        </div>
                        <div class="mode-option" id="opt-amark" onclick="selectMode('amark')">
                            <span class="mode-title">"A" Mark Only</span>
                            <span class="mode-desc" id="desc-amark">Test yourself against the "A" grade questions!</span>
                        </div>
                        <div class="mode-option" onclick="selectMode('challenge')">
                            <span class="mode-title">Challenge</span>
                            <span class="mode-desc">Test your streak. Use your 3 lifelines wisely to survive.</span>
                        </div>
                    </div>
                </div>

                <p id="q-count-preview" style="text-align: center; color: var(--primary-dark); font-weight:bold; margin-top: 15px;">Waiting for data...</p>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="btn-view-focus" class="nav-btn" onclick="viewFocusList()" disabled>View Focus List</button>
                    <button id="btn-attempt-focus" class="nav-btn" onclick="attemptFocusList()" disabled>Attempt Focus List</button>
                </div>
            </div>
            <div class="bottom-spacer"></div>
        </div>

        <div id="view-quiz" class="view-section">
            <canvas id="overlay-canvas"></canvas>

            <div class="card">
                <div class="top-bar" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    
                    <button onclick="exitToDashboard()" class="exit-btn" style="margin-right: auto;" aria-label="Exit" title="Exit">
                      <img src="icons/home.webp" style="width: 24px; height: 24px; vertical-align: middle;"> 
                    </button>
                    
                    <div class="hud-container" style="position: absolute; left: 50%; transform: translateX(-50%); display: flex; gap: 10px;">
                        <div id="hud-standard" style="display:flex; gap:10px;">
                            <div id="hud-box-score" class="hud-box" style="display: flex; align-items: center; gap: 8px;">
                                <img src="icons/score.webp" style="width: 24px; height: 24px;">
                                <span id="hud-score">0/0</span>
                            </div>
                            <div class="hud-box" style="display: flex; align-items: center; gap: 8px;">
                                <span id="hud-streak">0</span>
                                <img src="icons/fire.webp" style="width: 24px; height: 24px;">
                            </div>
                        </div>

                        <div id="hud-timer" class="hud-box timer-box">
                            <span id="timer-val">00:00</span>
                        </div>
                    </div>

                    <button onclick="toggleNotepad()" class="sketch-btn" style="margin-left: auto; pointer;" aria-label="SketchPad" title="SketchPad">
                      <img src="icons/pad.webp" style="width: 24px; height: 24px; vertical-align: middle;"> 
                    </button>
                </div>

                <div style="margin-bottom:15px; border-bottom: 2px solid var(--bg-tint); padding-bottom:10px; display: flex; justify-content: space-between; align-items: flex-end;">
                    <span id="q-meta" style="color:var(--primary-dark); font-weight:bold; font-size:0.9em;"></span>
                    <span id="q-progress" style="font-size: 0.9rem; font-weight: bold; white-space: nowrap; color: black;"></span>
                </div>

                <div id="lifeline-container" class="lifeline-bar">
                    <button class="lifeline-btn" id="btn-life-decay" onclick="useLifeline('decay')">
                        <img src="icons/decay.webp" class="lifeline-icon">
                        <span class="lifeline-label">Decay</span>
                    </button>

                    <button class="lifeline-btn" id="btn-life-rebound" onclick="useLifeline('rebound')">
                        <img src="icons/rebound.webp" class="lifeline-icon">
                        <span class="lifeline-label">Rebound</span>
                    </button>

                    <button class="lifeline-btn" id="btn-life-discharge" onclick="useLifeline('discharge')">
                        <img src="icons/discharge.webp" class="lifeline-icon">
                        <span class="lifeline-label">Discharge</span>
                    </button>
                </div>
                
                <div id="q-text" style="font-size:1.2em; font-weight:normal; line-height: 1.5; margin-bottom: 15px;"></div>
                <div id="q-image-area"></div>
                <div id="table-header-container"></div>
                <div id="options-area" class="options-grid"></div>
                <div id="feedback" style="margin-top:20px; font-weight:bold; height: 24px;"></div>

                <br>
                
                <div id="nav-buttons-container" style="display: flex; gap: 10px; align-items: stretch;">
                    <button id="next-btn" class="nav-btn" onclick="nextQuestion()" disabled style="flex: 8.5; width: 85%;">Next Question</button>
                    <button id="btn-focus-action" class="sketch-btn" onclick="addToFocusList()" style="flex: 1.5; width: 15%; display: flex; justify-content: center; align-items: center;">
                        <img src="icons/focus list.webp" style="width: 24px; height: 24px;">
                    </button>
                </div>

            </div>
            <div class="bottom-spacer"></div>
        </div>

        <div id="view-focus-list" class="view-section">
            <div class="card" style="max-width: 800px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="margin:0; color:var(--brand-primary);">Focus List</h2>
                    <button class="exit-btn" onclick="exitToDashboard()">Close</button>
                </div>

                <div class="focus-controls">
                    <select id="focus-sort" class="focus-select" onchange="sortFocusList()">
                        <option value="date">Date Added</option>
                        <option value="year">Year</option>
                        <option value="topic">Topic</option>
                        <option value="unit">Unit</option>
                    </select>
                    
                    <button class="sketch-btn" onclick="copyFocusList()" title="Copy to Clipboard" style="display: flex; align-items: center; gap: 6px;">
                        <img src="icons/copy.webp" style="width: 24px; height: 24px;"> Copy
                    </button>
                    
                    <button class="sketch-btn" onclick="clearFocusList()" title="Clear List" style="display: flex; align-items: center; gap: 6px;">
                        <img src="icons/clear.webp" style="width: 24px; height: 24px;"> Clear
                    </button>
                </div>

                <div class="focus-list-container">
                    <div class="focus-header-row">
                        <div style="text-align: center;">Year</div>
                        <div style="text-align: center;">Q#</div>
                        <div>Topic</div>
                        <div style="text-align: center;">Added</div>
                        <div style="text-align: center;">X</div>
                    </div>
                    <div id="focus-list-body">
                    </div>
                </div>
            </div>
        </div>

        <div id="view-summary" class="view-section">
            <div class="card" style="text-align: center; padding: 50px;">
                <h2 style="font-size: 2rem; color: var(--brand-primary);">Quiz Complete!</h2>
                <div style="font-size: 4rem; font-weight: bold; margin: 20px 0; color: var(--brand-accent); text-shadow: 2px 2px 0px black;" id="final-score">0%</div>
                <p id="final-stats" style="color: var(--black); font-size: 1.2rem;"></p>
                
                <div id="exam-review-section" style="display:none; margin-top:30px; border-top:1px solid #ccc; padding-top:20px;">
                    <h3 style="border:none; margin-bottom:10px;">Answer Breakdown</h3>
                    <p style="font-size:0.9rem;">Tap a number to review the question.</p>
                    <div id="review-grid" class="review-grid"></div>
                </div>

                <br>
                <button class="nav-btn" onclick="exitToDashboard()">Return to Dashboard</button>
            </div>
        </div>

        <div id="stats-modal" class="modal-overlay" onclick="closeStats(event)">
            <div class="modal-card">
                <h2 style="color:var(--brand-primary); text-align:center; margin-top:0;">Your Achievements</h2>
                
                <div class="stat-row"><span>Total Correct:</span><span class="stat-val" id="stat-total">0</span></div>
                <div class="stat-row"><span>First Attempt Correct:</span><span class="stat-val" id="stat-first">0</span></div>
                <div class="stat-row"><span>Highest Streak:</span><span class="stat-val" id="stat-streak">0</span></div>
                <div class="stat-row"><span>Challenge Record:</span><span class="stat-val" id="stat-challenge-record">0</span></div>
                
                <h4 style="margin-bottom:5px; border-bottom:1px solid #ccc; margin-top:20px;">Badges</h4>
                <div class="badge-grid" id="badge-container"></div>

                <h4 style="margin-bottom:10px; border-bottom:1px solid #ccc; margin-top:20px;">Data Management</h4>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="nav-btn" onclick="exportProgress()" style="font-size: 0.9rem;">
                        ⬇️ Backup Save
                    </button>
                    <button class="nav-btn" onclick="document.getElementById('file-import').click()" style="font-size: 0.9rem; background: linear-gradient(180deg, #444 0%, #222 100%); border-top: 1px solid #666;">
                        ⬆️ Restore Save
                    </button>
                    <input type="file" id="file-import" accept=".json" style="display:none" onchange="importProgress(this)">
                </div>

                <div style="border-top: 1px solid #ccc; padding-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                    <button class="nav-btn" onclick="document.getElementById('stats-modal').style.display='none'">Close</button>
                    <button class="danger-btn" onclick="resetStats()" style="margin-top:0;">⚠️ Reset All Progress</button>
                </div>
            </div>
        </div>
        
        <div id="heatmap-modal" class="modal-overlay" onclick="closeModal(event, 'heatmap-modal')">
            <div class="modal-card sticky-modal-card">
                <div style="flex-shrink: 0;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h2 style="color:var(--brand-primary); margin:0;">Topic Heatmap</h2>
                        <button class="exit-btn" onclick="document.getElementById('heatmap-modal').style.display='none'">Close</button>
                    </div>
                    
                    <div class="legend-grid">
                        <div class="legend-item hm-80">&gt;80%</div>
                        <div class="legend-item hm-70">&gt;70% (A)</div>
                        <div class="legend-item hm-60">&gt;60% (B)</div>
                        <div class="legend-item hm-50">&gt;50% (C)</div>
                        <div class="legend-item hm-40">&gt;40% (D)</div>
                        <div class="legend-item hm-fail">&lt;40%</div>
                    </div>
                </div>
                <div id="heatmap-content" class="scrollable-content"></div>
            </div>
        </div>
        
        <div id="about-modal" class="modal-overlay" onclick="closeModal(event, 'about-modal')">
            <div class="modal-card">
                <div class="about-meta-header" id="about-header-content"></div>
                
                <div class="manual-content">
                    <h4 style="margin-top:0;">Getting Started</h4>
                    Select a Unit, Topic, or Year from the filters.
                    Use <strong>Shuffle</strong> to mix up the order.
                    
                    <h4>Quiz Size</h4>
                    Check <strong>Limit Quiz Size</strong> to enable a dropdown menu that will limit the number of questions in your sample to the selected quantity, making a quiz manageable in a limited period of time.

                    <h4>Exam Mode</h4>
                    Check <strong>Exam Mode</strong> to enable the timer (SQA or Relaxed pacing). Instant feedback is hidden until the end of the session.
                    
                    <h4>Launching a Quiz</h4>
                    The <strong>Start Button</strong> now has three modes:
                    <ul>
                        <li><strong>Practice:</strong> Standard revision with instant feedback.</li>
                        <li><strong>Review:</strong> A smart playlist of your recent mistakes. It only appears when you have errors to fix.</li>
                        <li><strong>Challenge:</strong> A sudden-death survival mode. Build your streak!</li>
                    </ul>

                    <h4>Challenge Mode Lifelines</h4>
                    In Challenge Mode, use these tools to survive:
                    <br>
                    <img src="icons/decay.webp" class="manual-icon"> <strong>Decay:</strong> Removes 2 wrong answers.<br>
                    <img src="icons/rebound.webp" class="manual-icon"> <strong>Rebound:</strong> Shields you from 1 mistake.<br>
                    <img src="icons/discharge.webp" class="manual-icon"> <strong>Discharge:</strong> Skips the current question.
                    
                    <h4>Focus List</h4>
                    If you have bookmarked questions, you can:<br>
                    <strong>View Focus List</strong> to show to a teacher or tutor.<br>
                    <strong>Attempt Focus List</strong> to try all the bookmarked questions as a quiz.
                    
                    <h4>During the Quiz</h4>
                    <img src="icons/pad.webp" class="manual-icon"> <strong>SketchPad</strong>: Open the drawing tray for working or to annotate the question.<br>
                    <img src="icons/focus list.webp" class="manual-icon"> <strong>Focus List</strong>: Bookmark tricky questions for later, or to show to your teacher for help.<br>
                    <img src="icons/home.webp" class="manual-icon"> <strong>Exit</strong>: Return to the dashboard.
                    
                    <h4>Tools Palette</h4>
                    <img src="icons/trophy.webp" class="manual-icon"> <strong>Stats</strong>: Check progress & badges.<br>
                    <img src="icons/heatmap.webp" class="manual-icon"> <strong>Heatmap</strong>: See your strengths & weaknesses.<br>
                    <img src="icons/equation.webp" class="manual-icon"> <strong>Equations</strong> & <img src="icons/data.webp" class="manual-icon"> <strong>Data</strong>: Reference sheets.<br>
                    <img src="icons/darkmode.webp" class="manual-icon"> <strong>Theme</strong>: Toggle Dark/Light mode.
                    
                    <h4>Question Source</h4>
                    All questions from SQA exam papers 2012 to present.
                </div>

                <button class="nav-btn" style="margin-top:20px;" onclick="document.getElementById('about-modal').style.display='none'">Close</button>
            </div>
        </div>

        <div id="notepad-drawer">
            <div class="notepad-toolbar-new">
                <div class="tool-icon-btn" onclick="setTool('eraser')" title="Eraser" style="margin-right:8px;">
                     <img src="icons/eraser.webp" alt="Eraser" style="width: 24px; height: 24px; vertical-align: middle;">
                </div>
                
                <div class="tool-icon-btn color-black active" onclick="setTool('black')" style="color:black;" title="Black pen">✎</div>
                <div class="tool-icon-btn color-blue" onclick="setTool('blue')" style="color:blue;" title="Blue pen">✎</div>
                <div class="tool-icon-btn color-red" onclick="setTool('red')" style="color:red;" title="Red pen">✎</div>
                <div class="tool-icon-btn color-green" onclick="setTool('green')" style="color:green;" title="Green pen">✎</div>
                <div class="tool-icon-btn color-yellow" onclick="setTool('highlight')" style="color:#FFBF00; font-weight:bold; margin-right:8px;" title="Highlighter">
                    <img src="icons/highlighter.webp" alt="Eraser" style="width: 24px; height: 24px; vertical-align: middle;">
                </div>

                <div class="tool-icon-btn" id="btn-annotate" onclick="toggleAnnotate()" title="Annotate Question">
                    <img src="icons/annotate.webp" alt="Eraser" style="width: 24px; height: 24px; vertical-align: middle;">
                </div>
                <div class="tool-icon-btn" onclick="clearCanvas('current')" title="Clear SketchPad" style="margin-right:8px;">
                    <img src="icons/clear.webp" alt="Eraser" style="width: 24px; height: 24px; vertical-align: middle;">
                </div>
                <div class="tool-icon-btn" onclick="toggleNotepad()" title="Close SketchPad">▼</div>
            </div>
            <div class="notepad-canvas-container">
                <canvas id="scrap-canvas"></canvas>
            </div>
        </div>
        
        <div class="fab-wrapper" id="fab-menu">
            <button class="fab-main-btn" onclick="toggleFab()">
                &#8942; </button>

            <div class="fab-items">
				<button class="fab-action-btn" onclick="openAbout()" title="About & Help">
                    <img src="icons/info.webp" style="width: 48px; height: 48px; vertical-align: middle;">
                </button>
                <button class="fab-action-btn" onclick="toggleTheme()" title="Toggle Dark Mode">
                    <img id="theme-icon" src="icons/darkmode.webp" style="width: 48px; height: 48px; vertical-align: middle;">
                </button>
                <button class="fab-action-btn" onclick="openEquations()" title="Equation List">
                    <img src="icons/equation.webp" style="width: 48px; height: 48px; vertical-align: middle;">
                </button>
                <button class="fab-action-btn" onclick="openData()" title="Data Sheet">
                    <img src="icons/data.webp" style="width: 48px; height: 48px; vertical-align: middle;">
                </button>
				<button class="fab-action-btn" onclick="openHeatmap()" title="Topic Heatmap">
                    <img src="icons/heatmap.webp" style="width: 48px; height: 48px; vertical-align: middle;">
                </button>
                <button class="fab-action-btn" onclick="openStats()" title="Stats & Achievements">
                    <img src="icons/trophy.webp" style="width: 48px; height: 48px; vertical-align: middle;">
                </button>
            </div>
        </div>
        
        <div id="equation-modal" class="modal-overlay" onclick="closeModal(event, 'equation-modal')">
            <div class="modal-card image-modal-card">
                <div class="modal-header">
                    <h2>Relationships</h2>
                    <button onclick="document.getElementById('equation-modal').style.display='none'">✕</button>
                </div>
                <div class="zoom-container">
                    <img src="equations.webp" alt="Equation Sheet" class="sheet-image">
                </div>
            </div>
        </div>
        
        <div id="data-modal" class="modal-overlay" onclick="closeModal(event, 'data-modal')">
            <div class="modal-card image-modal-card">
                <div class="modal-header">
                    <h2>Data Sheet</h2>
                    <button onclick="document.getElementById('data-modal').style.display='none'">✕</button>
                </div>
                <div class="zoom-container">
                    <img src="datasheet.webp" alt="Data Sheet" class="sheet-image">
                </div>
            </div>
        </div>

        <script src="app.js" defer></script>
    </body>
</html>